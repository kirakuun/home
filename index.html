<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>テスト：あなたのIPアドレス</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; display:flex; align-items:center; justify-content:center; min-height:100vh; margin:0; background:#f6f8fa; }
    .card { background:#fff; padding:2rem; border-radius:8px; box-shadow:0 4px 14px rgba(0,0,0,0.08); max-width:520px; text-align:center; }
    .ip { font-size:2rem; font-weight:700; margin-top:1rem; color:#0b5; }
    .hint { margin-top:0.5rem; color:#666; font-size:0.9rem; }
    button { margin-top:1rem; padding:0.5rem 1rem; border:none; background:#0366d6; color:#fff; border-radius:6px; cursor:pointer; }
    button:active{ transform:translateY(1px); }
  </style>
</head>
<body>
  <div class="card">
    <h1>テストサイト：IPアドレス表示</h1>
    <div id="ip" class="ip">読み込み中…</div>
    <div class="hint">このページにアクセスしている端末の公開IPアドレスを表示します。</div>
    <button id="reload">再取得</button>
  </div>

  <script>
    async function fetchIP() {
      const el = document.getElementById('ip');
      el.textContent = '読み込み中…';
      try {
        // api.ipify.org を使って公開IPを取得
        const resp = await fetch('https://api.ipify.org?format=json');
        if (!resp.ok) throw new Error('APIエラー');
        const data = await resp.json();
        el.textContent = data.ip || '取得できませんでした';
      } catch (err) {
        // フォールバックサービスを試す
        try {
          const resp2 = await fetch('https://ifconfig.co/json');
          const d2 = await resp2.json();
          el.textContent = d2.ip || '取得できませんでした';
        } catch (err2) {
          el.textContent = '取得に失敗しました';
          console.error(err, err2);
        }
      }
    }

    document.getElementById('reload').addEventListener('click', fetchIP);
    fetchIP();
  </script>
</body>
</html>